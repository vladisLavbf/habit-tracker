<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Habit Tracker</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body {
      font-family: Arial;
      padding: 20px;
      background: var(--tg-theme-bg-color);
      color: var(--tg-theme-text-color);
    }

    button {
      padding: 10px;
      margin-top: 10px;
      width: 100%;
      border-radius: 8px;
      border: none;
      background: #2AABEE;
      color: white;
      font-size: 16px;
    }

    .habit {
      padding: 10px;
      margin-top: 10px;
      border-radius: 8px;
      background: rgba(0,0,0,0.05);
    }
  </style>
</head>
<body>

<h2>–ú–æ–∏ –ø—Ä–∏–≤—ã—á–∫–∏</h2>

<div id="habits"></div>

<button onclick="addHabit()">–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–≤—ã—á–∫—É</button>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();
    
    let habits = JSON.parse(localStorage.getItem("habits")) || [];
    
    function today() {
      return new Date().toISOString().split("T")[0];
    }
    
    function save() {
      localStorage.setItem("habits", JSON.stringify(habits));
    }
    
    function render() {
      const container = document.getElementById("habits");
      container.innerHTML = "";
    
      habits.forEach((habit, index) => {
        const isDoneToday = habit.dates.includes(today());
        const streak = calculateStreak(habit);
    
        const div = document.createElement("div");
        div.className = "habit";
        div.innerHTML = `
          <strong>${habit.title}</strong><br>
          –°–µ–≥–æ–¥–Ω—è: ${isDoneToday ? "‚úÖ" : "‚ùå"}<br>
          üî• –°—Ç—Ä–∏–∫: ${streak} –¥–Ω–µ–π
          <button onclick="toggleHabit(${index})">
            ${isDoneToday ? "–£–±—Ä–∞—Ç—å –æ—Ç–º–µ—Ç–∫—É" : "–û—Ç–º–µ—Ç–∏—Ç—å —Å–µ–≥–æ–¥–Ω—è"}
          </button>
        `;
        container.appendChild(div);
      });
    }
    
    function addHabit() {
      const title = prompt("–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏–≤—ã—á–∫–∏:");
      if (!title) return;
    
      habits.push({ title, dates: [] });
      save();
      render();
    }
    
    function toggleHabit(index) {
      const date = today();
      const dates = habits[index].dates;
    
      if (dates.includes(date)) {
        habits[index].dates = dates.filter(d => d !== date);
      } else {
        dates.push(date);
      }
    
      save();
      render();
    }
    
    function calculateStreak(habit) {
      let streak = 0;
      let currentDate = new Date();
    
      while (true) {
        const dateStr = currentDate.toISOString().split("T")[0];
        if (habit.dates.includes(dateStr)) {
          streak++;
          currentDate.setDate(currentDate.getDate() - 1);
        } else {
          break;
        }
      }
    
      return streak;
    }
    
    render();
    </script>

</body>
</html>
